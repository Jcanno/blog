(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{381:function(t,a,s){"use strict";s.r(a);var e=s(42),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h3",{attrs:{id:"内容协商"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#内容协商"}},[t._v("#")]),t._v(" 内容协商")]),t._v(" "),s("p",[t._v("TCP/IP 协议里，TCP、UDP 负责传输数据到目标地址，上层 HTTP 则需要对数据内容做一些工作，需要让应答双方知道这次请求数据内容是什么，总不能让服务端进行数据解析，这就降低了效率，因此有了数据协商，让双方按照约定内容定义数据格式。")]),t._v(" "),s("p",[t._v("HTTP 使用了邮件系统里的数据定义方案，叫做“多用途互联网邮件扩展”（Multipurpose Internet Mail Extensions），简称为 MIME。")]),t._v(" "),s("p",[t._v("常见的 MIME：")]),t._v(" "),s("ol",[s("li",[t._v("text：即文本格式的可读数据，我们最熟悉的应该就是 text/html 了，表示超文本文档，此外还有纯文本 text/plain、样式表 text/css 等。")]),t._v(" "),s("li",[t._v("image：即图像文件，有 image/gif、image/jpeg、image/png 等。")]),t._v(" "),s("li",[t._v("audio/video：音频和视频数据，例如 audio/mpeg、video/mp4 等。")]),t._v(" "),s("li",[t._v("application：数据格式不固定，可能是文本也可能是二进制，必须由上层应用程序来解释。常见的有 application/json，application/javascript、application/pdf 等，另外，如果实在是不知道数据是什么类型，像刚才说的“黑盒”，就会是 application/octet-stream，即不透明的二进制数据。")])]),t._v(" "),s("p",[t._v("同时 HTTP 在传输时会压缩数据，这时就通过 Encoding 定义压缩类型，常见压缩类型有：")]),t._v(" "),s("ol",[s("li",[t._v("gzip：GNU zip 压缩格式，也是互联网上最流行的压缩格式；")]),t._v(" "),s("li",[t._v("deflate：zlib（deflate）压缩格式，流行程度仅次于 gzip；")]),t._v(" "),s("li",[t._v("br：一种专门为 HTTP 优化的新压缩算法（Brotli）")])]),t._v(" "),s("p",[t._v("这样，客户端可以发送"),s("strong",[t._v("Accept")]),t._v("和"),s("strong",[t._v("Accept Encoding")]),t._v("来确定可以接收数据类型，服务端通过"),s("strong",[t._v("Content-Type")]),t._v("返回命中的数据类型。")]),t._v(" "),s("p",[t._v("除了以上两种内容协商请求头外，还有两个关于语言类型协商的请求头。")]),t._v(" "),s("p",[s("strong",[t._v("Accept-Language")]),t._v("字段标记了客户端可理解的自然语言，也允许用“,”做分隔符列出多个类型，例如：")]),t._v(" "),s("div",{staticClass:"language-jsx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-jsx"}},[s("code",[t._v("\nAccept"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Language"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" zh"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CN")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" zh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" en\n")])])]),s("p",[t._v("相应的，服务器应该在响应报文里用头字段"),s("strong",[t._v("Content-Language")]),t._v("告诉客户端实体数据使用的实际语言类型：")]),t._v(" "),s("div",{staticClass:"language-jsx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-jsx"}},[s("code",[t._v("\nContent"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Language"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" zh"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CN")]),t._v("\n")])])]),s("p",[t._v("字符集在 HTTP 里使用的请求头字段是"),s("strong",[t._v("Accept-Charset")]),t._v("，但响应头里却没有对应的 Content-Charset，而是在"),s("strong",[t._v("Content-Type")]),t._v("字段的数据类型后面用“charset=xxx”来表示，这点需要特别注意。")]),t._v(" "),s("p",[t._v("例如，浏览器请求 GBK 或 UTF-8 的字符集，然后服务器返回的是 UTF-8 编码，就是下面这样：")]),t._v(" "),s("div",{staticClass:"language-jsx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-jsx"}},[s("code",[t._v("Accept"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Charset"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" gbk"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" utf"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v("\nContent"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Type"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" text"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" charset"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v("\n")])])]),s("p",[t._v("不过现在的浏览器都支持多种字符集，通常不会发送 Accept-Charset，而服务器也不会发送 Content-Language，因为使用的语言完全可以由字符集推断出来，所以在请求头里一般只会有 Accept-Language 字段，响应头里只会有 Content-Type 字段。")])])}),[],!1,null,null,null);a.default=n.exports}}]);